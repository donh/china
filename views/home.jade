extends layout

block content
	div.reveal
		//- Any section element inside of this container is displayed as a slide
		div.slides

			section
				include cover
			section
				include gantt-d3
			section
				include agriculture
			section
				include QA131207
			//-section
			//-	include gantt-chart
			section
				include plan_01_5
			section
				include plan_06_5
			section
				include plan_07_5
			section
				include plan_08_5
			section
				include plan_09_5
			section
				include plan_10_5
			section
				include plan_11_5
			section
				include plan_12_5

			//-section#plan_13_5
			//-section
			//-	h2 習、李面對的困局與對策
			//-	div.slidenumber
			//-section#note

			section
				include urbanization
			section
				include tax

			//-section#financial_market

			//-section
			//-	h2 結論
			//-	div.slidenumber
			section
				include thank

			//-span.slidenumber
			//div.slidenumber
			//footer.slidenumber

	script(src='lib/js/head.min.js')
	script(src='js/Chart.js')
	//-script(src='js/reveal.min.js')
	script(src='js/don.js')
	//-script(src='js/jquery-2.0.3.min.js')
	//-script(src='js/d3.v3.js')
	//-script(src='js/gantt-chart-d3v2.js')
	//-script(src='js/gantt-chart.js')

	//-script(src='js/bootstrap.js')

	script(type='text/javascript').
		//- Full list of configuration options available here:
		//- https://github.com/hakimel/reveal.js#configuration
		Reveal.initialize({
			controls: true,
			progress: true,
			history: true,
			center: true,
			//width: 960,
			//height: 700,
			//width: 1300,
			//height: 700,
			//slidenumber: true,
			// Enable slide navigation via mouse wheel
			mouseWheel: true,
			// Apply a 3D roll to links on hover
			rollingLinks: true,

			theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
			transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

			// Optional libraries used to extend on reveal.js
			dependencies: [
				{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
				{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
				{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
			]
		});
		Reveal.addEventListener('local_finance', function(event) {
			local_finance();
		});
		Reveal.addEventListener('cargo', function(event) {
			cargo();
		});
		Reveal.addEventListener('loan', function(event) {
			loan();
		});
		Reveal.addEventListener('electricity', function(event) {
			electricity();
		});
		Reveal.addEventListener('agriculture', function(event) {
			agriculcutureDoughnut();
		});
		function slidenumber(event) {
			//-https://developer.mozilla.org/en-US/docs/Web/API/Document.querySelectorAll
			//-http://blog.romanliutikov.com/post/63383858003/how-to-forget-about-jquery-and-start-using-native
			var totalslides = document.querySelectorAll( '.reveal .slides section:not(.stack)' ).length;
			//console.log(totalslides);
			var current_slide = 0;

			var horizontal_slides = document.querySelectorAll( '.reveal .slides>section' );
			console.log(horizontal_slides);
			//console.log(horizontal_slides[1][0]);
			for (var i = 0; i < event.indexh; i++) {
				// get subslides
				var subslides = horizontal_slides[i].querySelectorAll('section');
				var footers = horizontal_slides[i].querySelectorAll('.slidenumber');
				//console.log(footers);
				if (footers[0]) {
					//console.log(footers[0]);
					//console.log(footers[0].innerText);
					//console.log(footers[0].getAttribute('innerText'));
					//document.querySelector('.el').getAttribute('key');
				}
				console.log('subslides of horizontal_slides[' + i + ']');
				console.log(subslides);
				if (subslides[0]) {
					console.log(subslides[0]);
					//-console.log(subslides[0].getAttribute('div.slidenumber'));
					//console.log(subslides[0].querySelector('.slidenumber'));
					//console.log(subslides[0].getElementsByClassName('slidenumber'));
					//console.log(subslides[0].getElementsByClassName('slidenumber')[0]);
					console.log(subslides[0].querySelector('.slidenumber').innerText);
					console.log(subslides[0].getElementsByClassName('slidenumber').innerText);
					//jQuery(".slidenumber").text(number);
					//jQuery(subslides[0].slidenumber).text('hi');
					//console.log(subslides[0].getElementsByClassName('slidenumber')[0].getAttribute('innerText'));
					//console.log(subslides[0].getElementsByClassName('slidenumber')[0].attributes);
					//console.log(subslides[0].querySelector('.slidenumber').value);
				}
				// if subslides.length is 0, add 1 for horizontal slide, else add subslides.length
				current_slide += (subslides.length === 0) ? 1 : subslides.length;
			}
			//console.log(current_slide);
			current_slide += event.indexv+1;
			//console.log(current_slide);
			//console.log(current_slide.toString()+"/"+totalslides.toString());
			return current_slide.toString()+"/"+totalslides.toString();
		}
		Reveal.addEventListener('slidechanged', function(event) {
			//console.log(event.currentSlide);
			//console.log(Reveal.getIndices());
			//cargo2();
			//var number = slidenumber(event);
			//jQuery(".slidenumber").text(number);
			//$(".slide-number").text(currentPageFormatter(event));
		});
		Reveal.addEventListener('ready', function(event) {
			var total = document.querySelectorAll( '.reveal .slides section:not(.stack)' );
			var pages = new Array();
			//console.log(total);
			for (var i = 0; i < total.length; i++) {
				//console.log(total[i]);
				//console.log(total[i].querySelector('.slidenumber'));
				if (total[i].querySelector('.slidenumber')) {
					pages.push(i+1);
				}
			}
			//console.log(event.currentSlide);
			//console.log(Reveal.getIndices());
			//console.log(pages.length);
			//console.log(pages);
			var totalslides = total.length;

			$(".slidenumber").each(function( index ) {
				//console.log( index + ": " + $( this ).text() );
				//jQuery(".slidenumber").text(number);
				$( this ).text(pages[index].toString() + '/' + totalslides.toString());
			});

			//var number = slidenumber(event);
			//jQuery(".slidenumber").text(number);
			$('<aside class="controls slide-number" style="display: block; left: 10px; right: initial;bottom: -30px; text-align: center;"></aside>')
			.text(currentPageFormatter(event))
			.appendTo('.reveal.center');
		});
		function currentPageFormatter(event) {
			var formattedStr;
			if (event.indexh === 0) {
				return "";
			}
			formattedStr = event.indexh;
			if (event.indexv) {
				formattedStr += "/" + event.indexv;
			}
			return formattedStr;
		}
		/*
		Reveal.addEventListener( 'ready', function( event ) {
			$('<aside class="controls slide-number" style="display: block; left: 10px; right: initial;bottom: -30px; text-align: center;"></aside>')
			.text(currentPageFormatter(event))
			.appendTo('.reveal.center');
		} );
		// Fires each time a new slide is activated
		Reveal.addEventListener( 'slidechanged', function( event ) {
			// event.previousSlide, event.currentSlide, event.indexh, event.indexv
			$(".slide-number").text(currentPageFormatter(event));
		} );
		*/
		/*
		$(".slidenumber").each(function( index ) {
			console.log( index + ": " + $( this ).text() );
			console.log(event.currentSlide);
			console.log(Reveal.getIndices());
		});
		*/
		/*
		$("section").each(function( index ) {
			//console.log( index + ": " + $( this ).text() );
			console.log( index + ": " );
		});
		*/
		//-Reveal.configure({ slideNumber: true });
